┌──────────────────────────────┐        ┌──────────────────────────────┐
│            MAIN              │        │          UI (thread)         │
├──────────────────────────────┤        ├──────────────────────────────┤
│ parse args                   │        │ status line                  │
│ select audio configs         │        │ spinner                      │
│ create channels              │        └──────────────────────────────┘
│ spawn threads                │
└───────────────┬──────────────┘
                │
                │
┌───────────────▼──────────────┐        ┌──────────────────────────────┐
│       RECORD (thread)        │        │      KEYBOARD (thread)       │
├──────────────────────────────┤        ├──────────────────────────────┤
│ mic capture                  │        │ space  -> pause              │
│ voice activity detect        │        │ esc    -> shutdown           │
│ detect speech while playing  │        │ ctrl-c -> shutdown           │
│ interrupt_counter += 1       │        └───────────────┬──────────────┘
│ send stop_play               │                        │
│ send utterance audio         │                        │
└───────────────┬──────────────┘                        ▼
                │ utterance                    ┌──────────────────────────┐
                │                              │     PLAYBACK (thread)    │
┌───────────────▼──────────────┐               ├──────────────────────────┤
│   CONVERSATION (thread)      │               │ audio queue              │
├──────────────────────────────┤               │ output callback          │
│ Whisper: speech -> text      │               │ clear queue on stop      │
│ LLM token stream             │               │ pause -> silence         │
│                              │               └───────────────▲──────────┘
│  ┌────────────────────────┐  │                               │
│  │      PHRASE QUEUE      │  │                               │
│  │     (text buffer)      │  │                               │
│  │ wait for boundary      │  │                               │
│  └───────────┬────────────┘  │                               │
│              │ phrase ready  │                               │ stop_play
│ OpenTTS: text -> speech      │                               │
│ stop on interrupt            │                               │
│ send audio chunks            │                               │
└───────────────┬──────────────┘                               │
                │ audio chunks                                 │
                ▼                                              │
┌──────────────────────────────┐                               │
│        ROUTER (thread)       │                               │
├──────────────────────────────┤                               │
│ receive audio chunks         │                               │
│ channel mapping              │                               │
│ forward to playback          │───────────────────────────────┘
└──────────────────────────────┘